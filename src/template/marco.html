<div
  id="readme"
  class="Box-body readme blob js-code-block-container p-5 p-xl-6 gist-border-0"
>
  <% if (user) { %>
    <h2><%= user.name %></h2>
  <% } %>
  <article class="markdown-body entry-content container-lg" itemprop="text">
    <ol dir="auto">
      <li>事件队列</li>
    </ol>
    <p dir="auto">
      所有的任务可以分为同步任务和异步任务，同步任务，顾名思义，就是立即执行的任务，同步任务一般会直接进入到主线程中执行；而异步任务，就是异步执行的任务，比如
      ajax 网络请求，setTimeout
      定时函数等都属于异步任务，异步任务会通过事件队列( Event Queue
      )的机制来进行协调。
    </p>
    <p dir="auto">
      同步和异步任务分别进入不同的执行环境，同步的进入主线程，即主执行栈，异步的进入
      Event Queue 。主线程内的任务执行完毕为空，会去 Event Queue
      读取对应的任务，推入主线程执行。 上述过程的不断重复就是我们说的 Event Loop
      (事件循环)。
    </p>
    <p dir="auto">
      事件循环过程是一个宏观的表述，实际上因为异步任务之间并不相同，因此他们的执行优先级也有区别。不同的异步任务被分为两类：微任务
      (micro task) 和宏任务 (macro task)。
    </p>
    <p dir="auto">以下事件属于宏任务：</p>
    <p dir="auto">setInterval() setTimeout()</p>
    <p dir="auto">以下事件属于微任务：</p>
    <p dir="auto">
      promise.then() Async/Await(实际就是 promise) new MutaionObserver()
    </p>
    <p dir="auto">下面通过代码来理解：</p>
    <div
      class="highlight highlight-source-js notranslate position-relative overflow-auto"
      dir="auto"
    >
      <pre><span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">1</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-en">setTimeout</span><span class="pl-kos">(</span><span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
  <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">2</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

  <span class="pl-v">Promise</span><span class="pl-kos">.</span><span class="pl-en">resolve</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">then</span><span class="pl-kos">(</span><span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">3</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span><span class="pl-kos">,</span> <span class="pl-c1">0</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-v">Promise</span><span class="pl-kos">.</span><span class="pl-en">resolve</span><span class="pl-kos">(</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">then</span><span class="pl-kos">(</span><span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">4</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-en">setTimeout</span><span class="pl-kos">(</span><span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">5</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

      <span class="pl-v">Promise</span><span class="pl-kos">.</span><span class="pl-en">resolve</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">then</span><span class="pl-kos">(</span><span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
        <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">6</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">,</span> <span class="pl-c1">0</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-v">Promise</span><span class="pl-kos">.</span><span class="pl-en">resolve</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">then</span><span class="pl-kos">(</span><span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
      <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">7</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">)</span>
  <span class="pl-kos">.</span><span class="pl-en">then</span><span class="pl-kos">(</span><span class="pl-k">function</span> <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-kos">{</span>
    <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">8</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
  <span class="pl-kos">}</span><span class="pl-kos">)</span><span class="pl-kos">;</span>

<span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-c1">9</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre>
      <div class="zeroclipboard-container position-absolute right-0 top-0">
        <clipboard-copy
          aria-label="Copy"
          class="ClipboardButton btn js-clipboard-copy m-2 p-0 tooltipped-no-delay"
          data-copy-feedback="Copied!"
          data-tooltip-direction="w"
          value="console.log(1);
          setTimeout(function () {
            console.log(2);

            Promise.resolve().then(function () {
              console.log(3);
            });
          }, 0);

          Promise.resolve()
            .then(function () {
              console.log(4);
              setTimeout(function () {
                console.log(5);

                Promise.resolve().then(function () {
                  console.log(6);
                });
              }, 0);
              Promise.resolve().then(function () {
                console.log(7);
              });
            })
            .then(function () {
              console.log(8);
            });

          console.log(9);"
          tabindex="0"
          role="button"
        >
          <svg
            aria-hidden="true"
            height="16"
            viewBox="0 0 16 16"
            version="1.1"
            width="16"
            data-view-component="true"
            class="octicon octicon-copy js-clipboard-copy-icon m-2"
          >
            <path
              fill-rule="evenodd"
              d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"
            ></path>
            <path
              fill-rule="evenodd"
              d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"
            ></path>
          </svg>
          <svg
            aria-hidden="true"
            height="16"
            viewBox="0 0 16 16"
            version="1.1"
            width="16"
            data-view-component="true"
            class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2"
          >
            <path
              fill-rule="evenodd"
              d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"
            ></path>
          </svg>
        </clipboard-copy>
      </div>
    </div>
    <ol dir="auto">
      <li>先执行当前宏任务的同步任务，很明显先打印1，9；</li>
      <li>
        宏任务执行完成执行该宏任务下的微任务：4，这里需要分析先是执行7，还是8？我们思考promise,then的原理，链式then是等上一个then执行完才会执行，而4打印后，先执行的是7,所以7的微任务在8的前面，所以先打印7，后打印8；
        （至此：1，9，4，7，8）
      </li>
      <li>
        当前宏任务微任务执行完毕，则执行下一个宏任务：2，2执行完后当前宏任务执行完成，开始执行该宏任务下的微任务：3；（至此：
        1，9，4，7，8，2，3）
      </li>
      <li>
        继续执行下一个宏任务：5，当前宏任务执行完成，执行当前宏任务下的微任务：6；
      </li>
    </ol>
    <p dir="auto">所以以上代码执行顺序： 1，9，4，7，8，2，3，5，6</p>
    <p dir="auto">
      <a href="/Jeriming/learn-summary/blob/main/src/js/js.md">返回</a>
    </p>
  </article>
</div>
